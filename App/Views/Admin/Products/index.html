{% extends "admin_base.html" %}

{% block title %}ניהול מוצרים{% endblock %}

{% block dashIcon %}
<svg class="bi bi-x-diamond dashboard_title_icon" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  <path fill-rule="evenodd" d="M6.95.435c.58-.58 1.52-.58 2.1 0l6.515 6.516c.58.58.58 1.519 0 2.098L9.05 15.565c-.58.58-1.519.58-2.098 0L.435 9.05a1.482 1.482 0 0 1 0-2.098L6.95.435zm1.4.7a.495.495 0 0 0-.7 0L1.134 7.65a.495.495 0 0 0 0 .7l6.516 6.516a.495.495 0 0 0 .7 0l6.516-6.516a.495.495 0 0 0 0-.7L8.35 1.134z"/>
  <path fill-rule="evenodd" d="M11.854 4.146a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708-.708l7-7a.5.5 0 0 1 .708 0z"/>
  <path fill-rule="evenodd" d="M4.146 4.146a.5.5 0 0 0 0 .708l7 7a.5.5 0 0 0 .708-.708l-7-7a.5.5 0 0 0-.708 0z"/>
</svg>
{% endblock %}

{% block dashTitle %}מוצרים{% endblock %}

{% block dashSubtitle %}רשימת מוצרים{% endblock %}

{% block body %}

<!--Export to text file-->
<div class="mt-4 mb-4">
    <!--Export errors-->
    {% for error in textErrors %}
    <div class="text-danger">
        <span>* </span>{{error}}
    </div>
    {% endfor %}
    <a href="#export" data-toggle="collapse" class="btn btn-light">
        ייצא לקובץ טקסט
        <svg class="bi bi-box-arrow-in-down" width="1em" height="1em" viewBox="0 0 16 16" fill="currentColor"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
                d="M4.646 8.146a.5.5 0 01.708 0L8 10.793l2.646-2.647a.5.5 0 01.708.708l-3 3a.5.5 0 01-.708 0l-3-3a.5.5 0 010-.708z"
                clip-rule="evenodd" />
            <path fill-rule="evenodd" d="M8 1a.5.5 0 01.5.5v9a.5.5 0 01-1 0v-9A.5.5 0 018 1z" clip-rule="evenodd" />
            <path fill-rule="evenodd"
                d="M1.5 13.5A1.5 1.5 0 003 15h10a1.5 1.5 0 001.5-1.5v-8A1.5 1.5 0 0013 4h-1.5a.5.5 0 000 1H13a.5.5 0 01.5.5v8a.5.5 0 01-.5.5H3a.5.5 0 01-.5-.5v-8A.5.5 0 013 5h1.5a.5.5 0 000-1H3a1.5 1.5 0 00-1.5 1.5v8z"
                clip-rule="evenodd" />
        </svg>
    </a>
    <form action="/admin/products/export_txt" method="POST">
        <div id="export" class="main-container collapse mb-4 col-12 col-lg-4 ">
            <div class="input-group mb-4 mt-4">
                <input type="text" name="txt_file_name" class="form-control" placeholder="שם הקובץ">
            </div>
            <button class="btn btn-lg btn-primary btn-block w-50" type="submit">ייצא</button>
        </div>
    </form>
</div>









<!--Search bar-->
<div>
    <div class="form-row">
        <!--Search by ID-->
        <div class="form-group col-md-1">
            <input id="searchInputID" class="form-control mr-sm-2" type="number" min="1" placeholder="מזהה מוצר" aria-label="Search">
        </div>
        <!--Search by category-->
        <div class="form-group col-md-3">
            <div class="input-group">
                <select class="custom-select" id="search_category_input">
                {% if categories is not empty %}
                    <option value="0" selected>חפש לפי קטגוריה</option>
                    {% for cat in categories %}
                    <option value="{{cat.category_id}}">{{cat.display_name}}</option>
                    {% endfor %}
                {% endif %}
                </select>
            </div>
        </div>
        <!--Search by product name-->
        <div class="form-group col-md-2">
            <input id="search_name_input" class="form-control mr-sm-2" type="text" placeholder="שם המוצר" aria-label="Search">
        </div>
    </div>
</div>









<!--Products table-->
<div class="table-responsive">
  <table class="table table-hover">
      <thead>
          <tr class="bg-light">
              <th scope="col">מזהה</th>
              <th scope="col">קטגוריה</th>
              <th scope="col">שם המוצר</th>
              <th scope="col">מחיר</th>
              <th scope="col">כמות</th>
              <th scope="col">תאריך העלאה</th>
              <th scope="col" class="text-center">פעולות</th>
          </tr>
      </thead>
      <tbody id="productsTableBody">

          {% for p in products %}
          <!--Product-->
          <tr>
              <th scope="row">{{p.product_id}}</th>
              <td>{{p.display_name}}</td>
              <td>{{p.product_name}}</td>
              <td>{{p.product_price}}</td>
              <td>{{p.product_quantity}}</td>
              <td>{{p.uploaded_at}}</td>
              <!--Product row buttons-->
              <td>
                  <div class="d-flex justify-content-end">
                      <form action="/admin/products/delete/{{p.product_id}}" method="POST">
                          <button class="btn btn-primary mr-2" name="deleteProduct">הסרה</button>
                      </form>
                      <a href="/admin/products/edit/{{p.product_id}}" class="btn btn-primary mr-2">עדכון</a>
                      <div class="d-flex align-items-end">
                          <a href="#product_info{{p.product_id}}" class="btn btn-default" data-toggle="collapse">
                              <svg class="bi bi-chevron-compact-down" width="1em" height="1em" viewBox="0 0 16 16"
                                  fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                  <path fill-rule="evenodd"
                                      d="M1.553 6.776a.5.5 0 01.67-.223L8 9.44l5.776-2.888a.5.5 0 11.448.894l-6 3a.5.5 0 01-.448 0l-6-3a.5.5 0 01-.223-.67z"
                                      clip-rule="evenodd" />
                              </svg>
                          </a>
                      </div>
                  </div>
              </td>
          </tr>
          <tr id="product_info{{p.product_id}}" class="main-container collapse" >
              <td colspan="4">
                  <div class="d-flex">
                      <div class="w-25">
                          <img src="/images/{{p.product_img}}" alt="{{p.display_name}}" class="img-thumbnail">
                      </div>
                      <div class="pl-4">
                          <span class="h6">תיאור המוצר</span>
                          <div>
                              {{p.description}}
                          </div>
                      </div>
                  </div>
              </td>
              <td colspan="7">
                  <div class="table-responsive">
                      <table class="table table-hover">
                            <thead>
                                <tr class="bg-light">
                                    <th scope="col">צבע</th>
                                    <th scope="col">S</th>
                                    <th scope="col">M</th>
                                    <th scope="col">L</th>
                                    <th scope="col">XL</th>
                                </tr>
                            </thead>
                            <tbody id="productsColorsSizesTable">
                                {% for color in colors %}
                                    {% if color.color_id ==1 %}
                                        <tr>
                                            <th scope="row">{{color.display_name}}</th>
                                            {% for sizequantity in SizesQuantity %}
                                               {% if sizequantity.product_id is same as(p.product_id) %}
                                                 {% if sizequantity.color_id is same as(color.color_id) %}
                                                        {% if sizequantity.size_id==1 %}
                                                            <td>{{sizequantity.quantity}}</td>
                                                        {% elseif sizequantity.size_id==2 %}
                                                            <td>{{sizequantity.quantity}}</td>
                                                        {% elseif sizequantity.size_id==3 %}
                                                            <td>{{sizequantity.quantity}}</td>
                                                        {% elseif sizequantity.size_id==4 %}
                                                            <td>{{sizequantity.quantity}}</td>
                                                        {% endif %}
                                                 {% endif %}
                                               {% endif %}
                                            {% endfor %}
                                       </tr>
                                    {% elseif color.color_id ==2 %}
                                       <tr>
                                            <th scope="row">{{color.display_name}}</th>
                                            {% for sizequantity in SizesQuantity %}
                                              {% if sizequantity.product_id is same as(p.product_id) %}
                                                {% if sizequantity.color_id is same as(color.color_id) %}
                                                     {% if sizequantity.size_id==1 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==2 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==3 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==4 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% endif %}
                                                {% endif %}
                                              {% endif %}
                                            {% endfor %}
                                       </tr>
                                    {% elseif color.color_id ==3 %}
                                       <tr>
                                            <th scope="row">{{color.display_name}}</th>
                                            {% for sizequantity in SizesQuantity %}
                                              {% if sizequantity.product_id is same as(p.product_id) %}
                                               {% if sizequantity.color_id is same as(color.color_id) %}
                                                     {% if sizequantity.size_id==1 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==2 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==3 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==4 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% endif %}
                                               {% endif %}
                                             {% endif %}
                                           {% endfor %} 
                                       </tr>
                                    {% elseif color.color_id ==4 %}
                                       <tr>
                                            <th scope="row">{{color.display_name}}</th>
                                            {% for sizequantity in SizesQuantity %}
                                             {% if sizequantity.product_id is same as(p.product_id) %}
                                               {% if sizequantity.color_id is same as(color.color_id) %}
                                                     {% if sizequantity.size_id==1 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==2 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==3 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% elseif sizequantity.size_id==4 %}
                                                         <td>{{sizequantity.quantity}}</td>
                                                     {% endif %}
                                               {% endif %}
                                             {% endif %}
                                           {% endfor %}
                                       </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                      </table>
                  </div>
              </td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
</div>
{% endblock %}

{% block script %}
<script src="/js/Admin/products_index.js"></script>
{% endblock %}
